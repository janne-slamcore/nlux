{"version":3,"file":"hf-react.js","sources":["../../../../packages/shared/src/utils/debug.ts","../../../../packages/shared/src/types/error.ts","../../../../packages/react/hf/src/hooks/getAdapterBuilder.ts","../../../../packages/react/hf/src/hooks/useChatAdapter.ts"],"sourcesContent":["export const debug = (...messages: unknown[]) => {\n    if (process.env.NLUX_DEBUG_ENABLED !== 'true') {\n        return;\n    }\n\n    for (const message of messages) {\n        if (typeof message === 'string') {\n            console.log(`[nlux] ${message}`);\n            continue;\n        }\n\n        if (message && typeof message.toString === 'function') {\n            console.log(`[nlux] ${message.toString()}`);\n            continue;\n        }\n\n        console.log('[nlux] Debug:');\n        console.log(JSON.stringify(message, null, 2));\n    }\n};\n","import {NLErrorId} from './exceptions/errors';\n\nexport type NluxRawError = {\n    readonly message?: string;\n    readonly type?: string;\n    readonly source?: string;\n    readonly exceptionId?: NLErrorId;\n};\n\nexport class NluxError extends Error {\n    readonly exceptionId?: NLErrorId;\n    readonly message: string;\n    readonly source?: string;\n    readonly type: string;\n\n    constructor(rawError: NluxRawError = {}) {\n        super(rawError.message);\n\n        this.message = rawError.message ?? '';\n        this.source = rawError.source;\n        this.type = this.constructor.name;\n        this.exceptionId = rawError.exceptionId;\n    }\n}\n\nexport class NluxUsageError extends NluxError {\n}\n\nexport class NluxValidationError extends NluxError {\n}\n\nexport class NluxRenderingError extends NluxError {\n}\n","import {ChatAdapterBuilder, ChatAdapterOptions, createChatAdapter} from '@nlux/hf';\nimport {NluxUsageError} from '@shared/types/error';\n\nconst source = 'hooks/getAdapterBuilder';\n\nexport const getAdapterBuilder = <AiMsg>(\n    options: ChatAdapterOptions<AiMsg>,\n): ChatAdapterBuilder<AiMsg> => {\n    const {\n        model,\n        authToken,\n        dataTransferMode,\n        preProcessors,\n        maxNewTokens,\n        systemMessage,\n    } = options || {};\n\n    if (dataTransferMode && dataTransferMode !== 'stream' && dataTransferMode !== 'batch') {\n        throw new NluxUsageError({\n            source,\n            message: 'Data transfer mode for Hugging Face Inference API must be either \"stream\" or \"batch\"',\n        });\n    }\n\n    if (model === undefined) {\n        throw new NluxUsageError({\n            source,\n            message: 'You must provide either a model or an endpoint to use Hugging Face Inference API.',\n        });\n    }\n\n    let newAdapter = createChatAdapter<AiMsg>().withModel(model);\n\n    if (authToken !== undefined) {\n        newAdapter = newAdapter.withAuthToken(authToken);\n    }\n\n    if (dataTransferMode !== undefined) {\n        newAdapter = newAdapter.withDataTransferMode(dataTransferMode);\n    }\n\n    if (preProcessors?.input !== undefined) {\n        newAdapter = newAdapter.withInputPreProcessor(preProcessors.input);\n    }\n\n    if (preProcessors?.output !== undefined) {\n        newAdapter = newAdapter.withOutputPreProcessor(preProcessors?.output);\n    }\n\n    if (systemMessage !== undefined) {\n        newAdapter = newAdapter.withSystemMessage(systemMessage);\n    }\n\n    if (maxNewTokens !== undefined) {\n        newAdapter = newAdapter.withMaxNewTokens(maxNewTokens);\n    }\n\n    return newAdapter;\n};\n","import {ChatAdapterOptions, StandardChatAdapter} from '@nlux/hf';\nimport {debug} from '@shared/utils/debug';\nimport {useEffect, useState} from 'react';\nimport {getAdapterBuilder} from './getAdapterBuilder';\n\nconst source = 'hooks/useChatAdapter';\n\nexport const useChatAdapter = <AiMsg = string>(\n    options: ChatAdapterOptions<AiMsg>,\n): StandardChatAdapter<AiMsg> => {\n    if (!options.model) {\n        throw new Error('You must provide either a model or an endpoint to use Hugging Face Inference API.');\n    }\n\n    const [isInitialized, setIsInitialized] = useState(false);\n    const [adapter] = useState<StandardChatAdapter<AiMsg>>(\n        getAdapterBuilder<AiMsg>(options).create(),\n    );\n\n    const {\n        authToken,\n        dataTransferMode,\n        model,\n        systemMessage,\n        preProcessors: {\n            input: inputPreProcessor = undefined,\n            output: outputPreProcessor = undefined,\n        } = {},\n        maxNewTokens,\n    } = options || {};\n\n    useEffect(() => {\n        if (!isInitialized) {\n            setIsInitialized(true);\n            return;\n        }\n\n        debug({\n            source,\n            message: 'A new parameter has changed in useChatAdapter(). Adapter cannot be changed after ' +\n                'initialization and the new parameter will not be applied. Please re-initialize the adapter ' +\n                'with the new parameter. or user adapter methods to change the options and behaviour of ' +\n                'the adapter.',\n        });\n    }, [\n        authToken,\n        dataTransferMode,\n        model,\n        systemMessage,\n        inputPreProcessor,\n        outputPreProcessor,\n        maxNewTokens,\n    ]);\n\n    return adapter;\n};\n"],"names":["source","createChatAdapter","useState","useEffect"],"mappings":"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"}